## 性能测试分析调优

1. *步骤:*

* 确定问题。根据性能测试的结果来分析确定bug —— 测试⼈员职责
* 分析原因。分析问题产⽣的原因 —— 开发⼈员职责
* 给出解决⽅案。可以是修改软件配置、增加硬件资源配置、修改代码等—— 开发⼈员职责
* 验证解决⽅案。—— 测试⼈员回归测试
* 分析验证结果 —— 既要保证有问题的指标得到解决，⼜要保证其他指标没有出现新问题
* 性能分析和调优需要经过很多轮，才能最终解决问题

2. 性能测试监控关键指标:
   性能问题可以产生的原因:
    * 服务器的资源 —— 影响应⽤服务器和数据库服务器处理的速率和⽹络传输速率
    * JVM瓶颈分析 —— JAVA程序运⾏的环境
    * 数据库瓶颈分析 —— 数据库程序运⾏环境分析
    * 程序内部实现机制 —— 开发⼈员编写的代码分析
    * 压测机 —— 影响性能结果
3. 硬件服务器资源指标
    1. 服务器硬件
        * CPU
        * 内存
        * 磁盘
        * 运行速度从快到慢: CPU >> 内存 >> 磁盘
        * 存储空间从大到小:磁盘 >> 内存 >> CPU
    2. CPU时间介绍
        * CPU:单位HZ
            * 将将CPU划分为若⼲个时间⽚，为每个程序分配对应的时间⽚，保证所有的程序占⽤时间⽚来串⾏执⾏
            * CPU使用率= 已使用的时间片/总时间片*100%
            * 已使用的时间片= ⽤户CPU + 系统CPU
            * 总时间⽚ = ⽤户CPU + 系统CPU + 空闲CPU
            * ⽤户CPU：所有应⽤程序运⾏时消耗的CPU
            * 系统CPU：操作系统运⾏消耗的CPU
        * CPU监控命令: `top`<br>
          ![img.png](img.png)<br>
          **测试关注点**
        * CPU⾼时，需要确认是⽤户CPU⾼还是系统CPU⾼
        * 如果是⽤户CPU⾼，需要进⼀步分析对应的应⽤程序的执⾏效率是否有问题
        * 如果是系统CPU⾼，需要进⼀步观察其他的资源（内存、磁盘、⽹络等）是否存在问题
    3. 内存和虚拟内存
        * 内存：实际内存/物理内存，机器实际的内存空间，所有的程序运⾏都必须加载到内存中才能运⾏
        * 虚拟内存：⼀种虚拟化的技术。当内存空间不⾜时，从磁盘中读⼊数据，处理完成后写回磁盘，以此进⾏交换，保证在内存不⾜时，程序也能够运⾏。
        * **注意**
          * 由于虚拟内存，实际上完成了数据在磁盘和内存之间的读写过程，磁盘的速度要远慢于内存时，因此当使⽤虚拟内存时，说明内存已经不⾜，可能存在问题
        * **命令**
          * 查看总量:`top`
          * 查看虚拟内存的使用量:`vmstat`!<br>[img_1.png](img_1.png)<br>
        * 测试关注点:
          * 实际内存：查看内存使⽤百分⽐，检查是否超过80%
          * 虚拟内存：查看swap的si和so是否为0，如果不为0，说明内存可能不⾜
    4. 磁盘IO
        * 关注是磁盘读⼊和写出的速度，不是磁盘⼤⼩。
        * **命令**`iostat -x 1 1`<br>![img_2.png](img_2.png)<br>
        * 测试关注点
          * %util⾼，说明磁盘⻓时间占⽤CPU在发送数据，说明磁盘传输速度不⾜，存在瓶颈
          * %iowait⾼，说明磁盘IO传输数据的任务很多，在等待，说明磁盘传输速度不⾜，存在瓶颈
   5. 网络
        * 关注的是⽹络传输数据的速度
        * 命令:`sar -n DEV 1 2`<br>![img_3.png](img_3.png)<br>
        * 测试关注点实际统计的发送速率和接收速率，与⽹络的总带宽进⾏对⽐，查看使⽤的百分⽐（如果⽆限接近100%，说明存在⽹络性能瓶颈
        * 补充介绍
          * 宽带：⽤户（业务）维度来描述⽹络速率的⽅式。例如：20M宽带、100M宽带、1000M宽带
            * 速率单位：b(bit)/s
          * 带宽：数据在⽹络中传输的速率，在技术中都是通过带宽来描述速率
            * 速率单位：B(Byte)/s
            * 1B = 8bit
          * 实际情况：1000M宽带 —— 对应着的带宽速率为 1000/8 = 125M



